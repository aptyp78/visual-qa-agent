# Changelog

Все значительные изменения проекта документируются в этом файле.

Формат основан на [Keep a Changelog](https://keepachangelog.com/ru/1.0.0/).

## [1.1.0] - 2024-12-04

### Добавлено

- **Модуль utils/helpers.js** — общие утилиты для устранения дублирования:
  - `getSelector()` — получение CSS селектора элемента
  - `validateUrl()` — валидация URL (защита от небезопасных протоколов)
  - `validateFilePath()` — валидация путей файлов (защита от path traversal)
  - `withTimeout()` — обёртка для Promise с timeout
  - `RateLimiter` — простой rate limiter для API запросов
  - `findDeviceById()` — поиск устройства по ID в профилях
  - `safeExecute()` — безопасное выполнение async функций с логированием
  - `pluralize()` — склонение слов по числу (русский язык)

- **MCP-инструмент `visual_qa_audit_clickables`** — полный аудит кликабельных элементов:
  - Проверка размера touch targets (минимум 44px)
  - Проверка наличия accessible name
  - Обнаружение элементов за пределами viewport
  - Обнаружение наложений кликабельных элементов

### Улучшено

- **Безопасность**:
  - Валидация URL во всех методах (только http/https)
  - Валидация путей файлов для AI-анализа (защита от path traversal)
  - Rate limiting для AI API (защита от 429 ошибок)
  - Timeout для AI запросов (60 секунд по умолчанию)

- **Обработка ошибок**:
  - Заменены пустые `catch {}` блоки на информативное логирование в IssueDetector
  - Добавлена классификация ошибок AI (timeout, rate_limit, api_error)
  - Информация о возможности retry для временных ошибок

- **HTML Reporter**:
  - Исправлено отображение проблем в карточках устройств
  - Корректная привязка issues к устройствам через `detectedIssues`
  - Поддержка нового формата issues (title/description вместо message)

### Исправлено

- Баг в HTML Reporter: проблемы не отображались в карточках устройств (показывалось "Проблем не обнаружено")
- Дублирование кода поиска устройства в mcp-server.js

### Изменено

- Структура файлов: добавлена директория `src/utils/`
- AI Analyzer теперь использует RateLimiter и timeout
- Улучшенные сообщения об ошибках с контекстом `[IssueDetector]`

## [1.0.0] - 2024-12-04

### Добавлено

- Начальный релиз Visual QA Agent
- Мульти-устройственное тестирование (15+ устройств)
- Кросс-браузерная проверка (Chromium, Firefox, WebKit)
- AI-анализ через Claude Vision
- Pixel-perfect сравнение скриншотов
- Проверка accessibility (WCAG 2.1)
- HTML-отчёты с галереей скриншотов
- CLI интерфейс
- MCP-сервер для интеграции с Claude Code
- IssueDetector с actionable fixes
